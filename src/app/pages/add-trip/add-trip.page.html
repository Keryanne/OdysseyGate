<ion-header translucent class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/my-trips" text="" (click)="resetForm()"></ion-back-button>
    </ion-buttons>
    <ion-title>Ajouter un voyage</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content class="ion-padding" [fullscreen]="true">
  <!-- Étape 1 : Général -->
   @if (step === 1) {
    <div class="step-container" @stepAnimation>
      <div class="step-header">
        <div class="step-icon">
          <ion-icon name="home" class="icon"></ion-icon>
        </div>
        <div class="step-title">
          <p>Étape 1/4 </p>
          <h2>Général</h2>
        </div>
      </div>
      <form [formGroup]="form" class="form">
        <div class="form-group">
          <ion-label position="stacked">Destination  *</ion-label>
          <ion-input formControlName="destination" fill="outline" required></ion-input>
        </div>
        <div class="form-group">
          <ion-label position="stacked">Ville de départ *</ion-label>
          <ion-input formControlName="departureCity" fill="outline" required></ion-input>
        </div>
        <div class="form-group">
          <ion-item lines="none" button (click)="showStartPicker = true">
            <ion-label>De *</ion-label>
            <ion-text>{{ startDate ? (startDate | date: 'EEEE, d MMM yyyy HH:mm') : 'Sélectionner' }}</ion-text>
          </ion-item>
        </div>
        <div class="form-group">
          <ion-item lines="none" button (click)="showEndPicker = true">
            <ion-label>A *</ion-label>
            <ion-text>{{ endDate ? (endDate | date: 'EEEE, d MMM yyyy HH:mm') : 'Sélectionner' }}</ion-text>
          </ion-item>
        </div>
        <!-- Modale de date -->
        <ion-modal [isOpen]="showStartPicker" (ionModalDidDismiss)="showStartPicker = false">
          <ng-template>
            <ion-content class="ion-padding">
              <ion-datetime
                [presentation]="'date-time'"
                [value]="startDate"
                (ionChange)="onStartDateChange($event)"
                locale="fr-FR"
              ></ion-datetime>
              <ion-button expand="full" (click)="showStartPicker = false">OK</ion-button>
            </ion-content>
          </ng-template>
        </ion-modal>

        <ion-modal [isOpen]="showEndPicker" (ionModalDidDismiss)="showEndPicker = false">
          <ng-template>
            <ion-content class="ion-padding">
              <ion-datetime
                [presentation]="'date-time'"
                [value]="endDate"
                (ionChange)="onEndDateChange($event)"
                locale="fr-FR"
              ></ion-datetime>
              <ion-button expand="full" (click)="showEndPicker = false">OK</ion-button>
            </ion-content>
          </ng-template>
        </ion-modal>
        <div class="form-group">
          <ion-label position="stacked">Nombre de voyageurs</ion-label>
          <ion-input type="number" formControlName="people"></ion-input>
        </div>
      </form>
    </div>
   }

  <!-- Étape 2 : Transports -->
   @if (step === 2) {
     <div class="step-container" @stepAnimation>
      <app-transport-form
      [mode]="'full'"
      (formSubmitted)="onTransportStepSubmitted($event)">
      </app-transport-form>
    </div>
   }

   <!-- Étape 3 : Logements -->
   @if (step === 3) {
    <div class="step-container" @stepAnimation>
     <app-logement-form 
      [mode]="'full'"
      (formSubmitted)="onLogementStepSubmitted($event)">
    </app-logement-form>
    </div>
    }

    <!-- Étape 3 : Activités -->
    @if (step === 4) {
      <div class="step-container" @stepAnimation>
        <app-activity-form 
          [mode]="'full'"
          (formSubmitted)="onActivityStepSubmitted($event)">
        </app-activity-form>
      </div>
     }

  <!-- Boutons bas -->
  <div class="step-actions">
    @if (step !== 1) {
      <ion-button fill="outline" (click)="prevStep()" [disabled]="step === 1">Précédent</ion-button>
    }
    <div class="step-actions-right">
      @if (step !== 4) {
        <ion-button (click)="nextStep()" [disabled]="!isStep1Valid()">Suivant</ion-button>
      }
      <ion-button [disabled]="!isStep1Valid()" (click)="submitForm()">
        Valider
      </ion-button>
    </div>

  </div>
</ion-content>
